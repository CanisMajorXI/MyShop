<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>我的商店</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/navModule.css">
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/navModule.js"></script>
    <script src="js/mytools.js"></script>
    <script src="./js/model.js"></script>
    <script src="./js/merchandise-type.js"></script>
    <script src="./js/merchandise.js"></script>
    <script src="./js/purchase_record.js"></script>
    <style>
        section {
            min-height: 2000px;
        }
        .recommend {
            min-height: 500px;
            background-color: white;
            width: 70%;
        }

        .recommend {
            background-color: white;
        }
        .recommend-box {
            padding-top: 15px;
            padding-bottom: 15px;
            border-style: dashed;
            border-color: #aaaaaa;
            border-width: 0 0 2px;
            height: 130px;
        }
        .recommend-box:hover{
            background-color: #cecece;
        }
        .recommend-box img{
            width: 100px;
            height:100px;
        }
        .recommend-box .title {
            margin-left: -4%;
            font-size: 30px;
            font-weight: bold;
        }
        .recommend-box .content {
            position: relative;
            height: 100%;
        }
        .recommend-box .content .author {
            position: absolute;
            bottom: 0;
            margin-left: -10px;
            font-size: 17px;
            font-style: italic;
        }
        .recommend-box .info-group {
            position: absolute;
            font-size: 16px;
            right: 15px;
            bottom: 0;
        }

    </style>










    <style>
        #add-merchandiseType-form .form-group {
            margin-top: 10px;
            padding-right: 15px;
        }
        #add-merchandiseType-form button {
            margin-top: 10px;
            margin-left: 15px;
        }
    </style>
</head>
<body>
<header>
    <div class="header-top">
        <div class="title"><span>我的商店</span><small>&nbsp轻关易道，通商宽农</small></div>
    </div>
    <nav class="navbar  navbar-inverse" role="navigation" style="border-radius: 0">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                        data-target="#example-navbar-collapse">
                    <span class="sr-only">切换导航</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="example-navbar-collapse">
                <ul class="nav navbar-nav main-module">
                    <!--<li class="active homepage"><a href=""/myForum/home.htm">主页</a></li>-->
                    <li class="purchase"><a href="./purchase.html">进货</a></li>
                    <li class="wholesale"><a href="./wholesale.html">批发</a></li>
                    <li class="retail"><a  href="./retail.html">零售</a></li>
                    <li class="staff"><a href="./staff.html">员工</a></li>
                    <li class="memeber"><a href="member.html">会员</a></li>
                </ul>
                <script>
                    let curpage = window.location.pathname.substr(1).split('.')[0];
                    $("header .main-module ."+curpage).addClass("active");

                </script>
                <ul class="nav navbar-nav navbar-right login-group">
                    <li><a href="./register.html"><span class="glyphicon glyphicon-user"></span> 注册</a></li>
                    <li><a href="./login.html"><span class="glyphicon glyphicon-log-in"></span> 登录</a></li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<section>
    <div class="container-fluid recommend">
        <div class="merchandise-type-table"  style="padding-top: 10px">
            <table class="table">
                <div class="col-lg-8" style="text-align: center">
                    <span style="font-size: 20px;font-weight: bold">&nbsp&nbsp商品名称</span>
                </div>
                <!--<caption style="font-size: 20px;text-align: center;font-weight: bold">商品列表</caption>-->
                <div class="col-lg-4">
                    <div class="input-group">
                        <input type="text" class="form-control show-by-name-text">
                        <span class="input-group-btn">
						<button class="btn btn-default show-by-name-btn" type="button">
							按名称显示
						</button>
					</span>
                    </div><!-- /input-group -->
                </div>
                <thead>
                <tr>
                    <th>商品id</th>
                    <th>商品名称</th>
                    <th>建议零售价</th>
                    <th>批发价</th>
                    <th>商品保质期</th>
                </tr>
                </thead>
                <tbody>
                <tr class="active">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr class="success">
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                </tr>
                <tr  class="warning">
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                </tr>
                <tr  class="danger">
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                </tr>
                <tr class="info">
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                    <td>查询中...</td>
                </tr>
                </tbody>
            </table>
            <div style="padding-left: 25px;padding-right: 25px">
                <ul class="pager">
                    <li class="previous"><a>&larr; 上一页</a></li>
                    <li class="next"><a>下一页 &rarr;</a></li>
                </ul>
            </div>

        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                    增加商品
                </h3>
            </div>
            <div class="panel-body">
                <div id="add-merchandiseType-form">
                    <!-- form-begin -->
                    <form  class ="form-inline" role="form">
                        <div class="form-group">
                            <label>商品类型：</label>
                            <input type="text" class="form-control name"   placeholder="请输入商品名称">
                        </div>
                        <div class="form-group">
                            <label>过期时间：</label>
                            <input type="text" class="form-control expiration" placeholder="请输入名称">
                        </div>
                        <div class="form-group">
                            <label>进货价格：</label>
                            <input type="number" class="form-control purchasePrice"  placeholder="请输入进货价格">
                        </div>
                        <div class="form-group">
                            <label>批发价格：</label>
                            <input type="number" class="form-control wholesalePrice"  placeholder="请输入批发价格">
                        </div>
                        <div class="form-group">
                            <label>零售价格：</label>
                            <input type="number" class="form-control retailPrice" placeholder="请输入零售价格">
                        </div>
                        <button type="button" class="btn btn-success merchandise-type-btn">提交</button>
                        <button type="reset" class="btn btn-danger">重置</button>
                        <script>
                            $(".merchandise-type-btn").click(function () {
                               let merandise =  new MerchandiseType($("#add-merchandiseType-form .name").val(),
                                    null, $("#add-merchandiseType-form .expiration").val(),
                                    $("#add-merchandiseType-form .purchasePrice").val(),
                                    $("#add-merchandiseType-form .wholesalePrice").val(),
                                    $("#add-merchandiseType-form .retailPrice").val());
                                $.ajax({
                                    type: "post",
                                    url: "/api/merchandise-type/add",
                                    data: JSON.stringify(merandise),
                                    contentType: "application/json; charset=utf-8",
                                    dataType:"json",
                                    success: function (result) {
                                        alert(result);
                                    }
                                });
                            });

                        </script>
                    </form>
                    <!-- form-end -->
                    <script>

                    </script>
                </div>
            </div>
        </div>
        <div class="merchandise-table"  style="padding-top: 10px">
            <table class="table">
                <div class="col-lg-8" style="text-align: center">
                    <span style="font-size: 20px;font-weight: bold">&nbsp&nbsp当前商品库存</span>
                </div>
                <!--<caption style="font-size: 20px;text-align: center;font-weight: bold">商品列表</caption>-->
                <div class="col-lg-4">
                    <div class="input-group">
                        <input type="text" class="form-control show-by-name-text">
                        <span class="input-group-btn">
						<button class="btn btn-default show-by-name-btn" type="button">
							按名称显示
						</button>
					</span>
                    </div><!-- /input-group -->
                </div>
                <thead>
                <tr>
                    <th>商品单号</th>
                    <th>商品名称</th>
                    <th>生产日期</th>
                    <th>保质期</th>
                </tr>
                </thead>
                <tbody>
                <tr class="active">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr class="success">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr  class="warning">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr  class="danger">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr class="info">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                </tbody>
            </table>
            <div style="padding-left: 25px;padding-right: 25px">
                <ul class="pager">
                    <li class="previous"><a>&larr; 上一页</a></li>
                    <li class="next"><a>下一页 &rarr;</a></li>
                </ul>
            </div>

        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                    增加商品类型
                </h3>
            </div>
            <div class="panel-body">
                <div id="add-merchandises-list">
                    <ul class="list-group" id="shuigaishuishabi">
                    </ul>
                </div>
                <div id="add-merchandise-form">
                    <!-- form-begin -->
                    <form class="form-inline" role="form">
                        <div class="form-group">
                            <label>商品名称：</label>
                            <select class="form-control" id="select-name-return-id">
                            </select>
                        </div>
                        <div class="form-group">
                            <label>生产日期：</label>
                            <input type="text" class="form-control expiration" id="jiangzemin"placeholder="请输入名称">
                        </div>
                        <button type="button" class="btn btn-success merchandise-add-btn">添加到提交列表</button>
                        <button type="button" class="btn btn-success merchandises-submit-btn">全部提交</button>
                        <button type="reset" class="btn btn-danger">重置</button>
                        <script>
//                            // 商品类型类
//                            class MerchandiseType {
//                                constructor(name, picture, expiration, purchasePrice, wholesalePrice, retailPrice) {
//                                    this.name = name;
//                                    this.picture = picture;
//                                    this.expiration = expiration;
//                                    this.purchasePrice = purchasePrice;
//                                    this.wholesalePrice = wholesalePrice;
//                                    this.retailPrice = retailPrice;
//                                }
//                            }
//                            // 商品实体类
//                            class Merchandise {
//                                constructor(typeId, productDate) {
//                                    this.typeId = typeId;
//                                    this.productDate = productDate;
//                                }
//                            }
                            let temp_list = [];
                            // 先查询商品的类型和id，然后建立一个映射数组
                            let type_name = {};
                            $.ajax({
                                type: "post",
                                url: "/api/merchandise-type/query",
                                data: JSON.stringify(new MerchandiseType(null, null, null, null, null,
                                    null)),
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (result) {
                                    // json数据遍历添加select上
                                    alert(JSON.stringify(result));
                                    $.each(json, function (index, value) {
                                        type_name[value['id']] = value['name'];
                                        $("#select-name-return-id").append('<option value=' +
                                            value['id'] + '>' +
                                            value['name'] + '</option>');
                                    });
                                }
                            });

                            let json = [{
                                "id": 1,
                                "name": "脑白金",
                                "picture": "111",
                                "expiration": 111,
                                "purchasePrice": 500,
                                "wholesalePrice": 800,
                                "retailPrice": 999
                            }, {
                                "id": 2,
                                "name": "脑黄金",
                                "picture": null,
                                "expiration": 111111111,
                                "purchasePrice": 100,
                                "wholesalePrice": 200,
                                "retailPrice": 300
                            }, {
                                "id": 3,
                                "name": "安利",
                                "picture": null,
                                "expiration": 111111111,
                                "purchasePrice": 100,
                                "wholesalePrice": 200,
                                "retailPrice": 300
                            }, {
                                "id": 4,
                                "name": "纽崔莱",
                                "picture": null,
                                "expiration": 111111111,
                                "purchasePrice": 100,
                                "wholesalePrice": 200,
                                "retailPrice": 300
                            }, {
                                "id": 5,
                                "name": "纽崔莱",
                                "picture": null,
                                "expiration": 111111111,
                                "purchasePrice": 100,
                                "wholesalePrice": 200,
                                "retailPrice": 300
                            }, {
                                "id": 6,
                                "name": "纽崔莱",
                                "picture": null,
                                "expiration": 111111111,
                                "purchasePrice": 100,
                                "wholesalePrice": 200,
                                "retailPrice": 300
                            }, {
                                "id": 7,
                                "name": "小罐茶",
                                "picture": null,
                                "expiration": 111111111,
                                "purchasePrice": 100,
                                "wholesalePrice": 200,
                                "retailPrice": 300
                            }]

                            // 遍历添加到select中
                            $.each(json, function (index, value) {
                                type_name[value['id']] = value['name'];
                                $("#select-name-return-id").append('<option value=' + value['id'] + '>' +
                                    value['name'] + '</option>');
                            });
                            let name_list = {
                                'typeId': "商品名",
                                'productDate': "生产日期"
                            }

                            let item_index = 0;
                            // 添加到待提交列表中
                            $(".merchandise-add-btn").click(function () {
                                let merandise = new Merchandise($("#select-name-return-id").val(),
                                    $("#add-merchandise-form .expiration").val());
                                temp_list[item_index] = merandise;

                                let p_node = document.createElement('p');
                                let index = 0;
                                $.each(merandise, function (index, value) {
                                    if (index === "typeId") {
                                        $(p_node).append(name_list[index] + ' : ' + type_name[value] +
                                            " ");
                                    } else {
                                        $(p_node).append(name_list[index] + ' : ' + value);
                                    }
                                });
                                //
                                let item_node =
                                    "<li class='list-group-item'><button class='btn btn-danger remove-merchandise' item-id='" +
                                    (item_index++) + "'>删除</button></li>";
                                $("#shuigaishuishabi").append($(item_node).prepend(p_node));
                            });

                            // 动态绑定删除按钮
                            $("#shuigaishuishabi").on('click', '.remove-merchandise', function () {
                                let id = $(this).attr("item-id");
                                temp_list.splice(id, 1);
                                $(this).parent().remove();
                            });

                            // 提交全部
                            $(".merchandises-submit-btn").click(function () {
                                let MerchandiseList = []
                                $.each(temp_list, function (i, val) {
                                    if (val != undefined) {
                                        MerchandiseList.push(val);
                                    }
                                });
                                $.ajax({
                                    type: "post",
                                    url: "/api/merchandises/purchase",
                                    data: JSON.stringify(MerchandiseList),
                                    contentType: "application/json; charset=utf-8",
                                    dataType: "json",
                                    success: function (result) {
                                        if(result === 'ok')
                                            alert("成功！");
                                        location.reload();
                                    }
                                });
                            });
                        </script>
                    </form>
                    <!-- form-end -->
                    <script>
                    </script>
                    <script src="./laydate/laydate.js"></script>
                    <script>
                        //渲染日期组件
                        laydate.render({
                            elem: '#jiangzemin' //指定元素
                        });
                    </script>
                </div>
            </div>
        </div>
        <div class="purchase-record-table"  style="padding-top: 10px">
            <table class="table">
                <div class="col-lg-8" style="text-align: center">
                    <span style="font-size: 20px;font-weight: bold">&nbsp&nbsp进货订单查询</span>
                </div>
                <!--<caption style="font-size: 20px;text-align: center;font-weight: bold">商品列表</caption>-->
                <div class="col-lg-4">
                    <div class="input-group">
                        <input type="text" class="form-control show-by-name-text">
                        <span class="input-group-btn">
						<button class="btn btn-default show-by-name-btn" type="button">
							按名称显示
						</button>
					</span>
                    </div><!-- /input-group -->
                </div>
                <thead>
                <tr>
                    <th>进货单号</th>
                    <th>商品单号</th>
                    <th>商品名称</th>
                    <th>订单时间</th>
                    <th>生产日期</th>
                </tr>
                </thead>
                <tbody>
                <tr class="active">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr class="success">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr  class="warning">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr  class="danger">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                <tr class="info">
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                <td>查询中...</td>
                </tr>
                </tbody>
            </table>
            <div style="padding-left: 25px;padding-right: 25px">
                <ul class="pager">
                    <li class="previous"><a>&larr; 上一页</a></li>
                    <li class="next"><a>下一页 &rarr;</a></li>
                </ul>
            </div>

        </div>

    </div>

</section>
<footer>
    <div class="title">本网站仅供学习，由XiWinnie制作</div>
</footer>
</body>
</html>